<!-- digital_twin.html file -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D COUNTING — Bus Passenger Counting Pipeline</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e17;
    --surface: #111827;
    --surface-alt: #1a2235;
    --border: #1e2d4a;
    --text: #e2e8f0;
    --text-dim: #7b8ba5;
    --text-muted: #3e4d68;
    --accent: #38bdf8;
    --accent-glow: rgba(56, 189, 248, 0.15);
    --heat-hot: #ef4444;
    --heat-warm: #f59e0b;
    --heat-cool: #3b82f6;
    --green: #10b981;
    --green-glow: rgba(16,185,129,0.12);
    --purple: #a78bfa;
    --purple-glow: rgba(167,139,250,0.10);
    --pink: #f472b6;
    --orange: #fb923c;
    --red: #f87171;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* ─── Grain Overlay ─── */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 9999;
  }

  /* ─── Header ─── */
  .header {
    text-align: center;
    padding: 60px 20px 40px;
    position: relative;
  }
  .header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
  }
  .header h1 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2.2rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent), var(--purple));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 8px;
    letter-spacing: -1px;
  }
  .header p {
    color: var(--text-dim);
    font-size: 0.95rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ─── Stage Navigation ─── */
  .stage-nav {
    display: flex;
    justify-content: center;
    gap: 4px;
    padding: 30px 20px 10px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: linear-gradient(180deg, var(--bg) 70%, transparent);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    flex-wrap: wrap;
  }
  .stage-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 8px 14px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-dim);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.5px;
    text-decoration: none;

  }
  .stage-btn:hover { border-color: var(--accent); color: var(--text); }
  .stage-btn.active {
    background: var(--accent-glow);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: 0 0 20px rgba(56,189,248,0.1);
  }
  
  .home-btn {
    background: var(--surface-alt);
    border-color: var(--purple);
    color: var(--purple);
  }
  .home-btn:hover { background: var(--purple-glow); }

  /* ─── Flow Arrow ─── */
  .flow-connector {
    display: flex;
    justify-content: center;
    padding: 20px 0;
  }
  .flow-arrow {
    width: 2px;
    height: 50px;
    background: linear-gradient(180deg, var(--accent), transparent);
    position: relative;
  }
  .flow-arrow::after {
    content: '▼';
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    color: var(--accent);
    font-size: 10px;
  }

  /* ─── Stage Card ─── */
  .stage {
    max-width: 900px;
    margin: 0 auto 20px;
    padding: 0 20px;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeUp 0.6s ease forwards;
  }
  .stage:nth-child(2) { animation-delay: 0.1s; }
  .stage:nth-child(3) { animation-delay: 0.2s; }
  .stage:nth-child(4) { animation-delay: 0.3s; }
  .stage:nth-child(5) { animation-delay: 0.4s; }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .card:hover { border-color: rgba(56,189,248,0.3); }

  .card-header {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
  }
  .step-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 4px;
    background: var(--accent-glow);
    color: var(--accent);
    border: 1px solid rgba(56,189,248,0.3);
    white-space: nowrap;
  }
  .card-header h2 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
  }

  .card-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 320px;
  }
  @media (max-width: 700px) {
    .card-body { grid-template-columns: 1fr; }
  }

  .card-svg {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 30px;
    background: var(--surface-alt);
    border-right: 1px solid var(--border);
    min-height: 300px;
  }
  .card-svg svg {
    width: 100%;
    max-width: 380px;
    height: auto;
  }

  .card-text {
    padding: 26px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  .card-text p {
    font-size: 0.95rem;
    line-height: 1.8;
    color: var(--text-dim);
    margin-bottom: 14px;
  }
  .card-text p strong { color: var(--text); }

  .tag-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 8px;
  }
  .tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
    padding: 4px 10px;
    border-radius: 4px;
    background: var(--accent-glow);
    color: var(--accent);
    border: 1px solid rgba(56,189,248,0.2);
    letter-spacing: 0.5px;
  }

  .diagram-panel {
    padding: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface-alt);
    position: relative;
    overflow: hidden;
  }
  .diagram-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 20% 80%, rgba(56,189,248,0.04), transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(167,139,250,0.04), transparent 50%);
    pointer-events: none;
  }

  .info-panel {
    padding: 24px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 16px;
  }
  .info-panel p {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--text-dim);
  }
  .info-panel p strong {
    color: var(--text);
    font-weight: 600;
  }

  .tag-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    padding: 3px 8px;
    border-radius: 4px;
    background: rgba(16,185,129,0.1);
    color: var(--green);
    border: 1px solid rgba(16,185,129,0.2);
  }
  .tag.warn {
    background: rgba(245,158,11,0.1);
    color: var(--heat-warm);
    border-color: rgba(245,158,11,0.2);
  }
  .tag.err {
    background: rgba(239,68,68,0.1);
    color: var(--heat-hot);
    border-color: rgba(239,68,68,0.2);
  }

  /* ─── SVG Shared Styles ─── */
  svg text {
    font-family: 'JetBrains Mono', monospace;
  }

  /* ─── Summary Table ─── */
  .summary {
    max-width: 900px;
    margin: 40px auto 80px;
    padding: 0 20px;
  }
  .summary-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--surface);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .summary-table th {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 14px 16px;
    text-align: left;
    color: var(--accent);
    background: var(--surface-alt);
    border-bottom: 1px solid var(--border);
  }
  .summary-table td {
    padding: 12px 16px;
    font-size: 0.82rem;
    color: var(--text-dim);
    border-bottom: 1px solid var(--border);
  }
  .summary-table tr:last-child td { border-bottom: none; }
  .summary-table tr:hover td { color: var(--text); background: rgba(56,189,248,0.03); }

  /* ─── Pulse Animation for hotspots ─── */
  @keyframes pulse {
    0%, 100% { r: 6; opacity: 0.8; }
    50% { r: 10; opacity: 0.4; }
  }
  .hotspot { animation: pulse 2s ease-in-out infinite; }
  .hotspot:nth-child(2) { animation-delay: 0.3s; }
  .hotspot:nth-child(3) { animation-delay: 0.6s; }
  .hotspot:nth-child(4) { animation-delay: 0.9s; }
  .hotspot:nth-child(5) { animation-delay: 1.2s; }

  @keyframes dashmove {
    to { stroke-dashoffset: -20; }
  }
  .dash-anim {
    animation: dashmove 1s linear infinite;
  }

  @keyframes crossFade {
    0%, 40% { opacity: 1; }
    50%, 90% { opacity: 0.3; }
    100% { opacity: 1; }
  }

  /* ─── Plane glow ─── */
  @keyframes planeGlow {
    0%, 100% { stroke-opacity: 0.6; filter: drop-shadow(0 0 3px rgba(56,189,248,0.3)); }
    50% { stroke-opacity: 1; filter: drop-shadow(0 0 8px rgba(56,189,248,0.6)); }
  }
  .glow-line {
    animation: planeGlow 2.5s ease-in-out infinite;
  }

  /* counter animation */
  @keyframes countUp {
    0% { opacity: 0; transform: translateY(8px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  /* ─── Stage 6: Gallery ─── */
  .card-body-gallery {
    display: flex;
    flex-direction: column;
    grid-template-columns: 1fr;
    padding: 0;
  }

  .gallery-nav {
    display: flex;
    gap: 2px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface-alt);
    overflow-x: auto;
  }
  .gal-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    padding: 8px 14px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-dim);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .gal-btn:hover { border-color: #f472b6; color: var(--text); }
  .gal-btn.active {
    background: rgba(244,114,182,0.12);
    border-color: #f472b6;
    color: #f472b6;
  }
  .gal-num {
    font-weight: 700;
    font-size: 0.6rem;
    background: rgba(244,114,182,0.2);
    padding: 2px 5px;
    border-radius: 3px;
  }

  .frame-container {
    position: relative;
    min-height: 400px;
    background: var(--surface-alt);
  }
  .frame {
    display: none;
    animation: frameFade 0.4s ease;
  }
  .frame.active { display: block; }
  @keyframes frameFade {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .frame img {
    width: 100%;
    display: block;
    border-bottom: 1px solid var(--border);
  }
  .frame-caption {
    padding: 18px 24px 22px;
  }
  .frame-caption p {
    font-size: 0.86rem;
    line-height: 1.7;
    color: var(--text-dim);
    margin-top: 10px;
  }
  .frame-caption p strong {
    color: var(--text);
  }
  .frame-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 4px;
    background: rgba(244,114,182,0.12);
    color: #f472b6;
    border: 1px solid rgba(244,114,182,0.25);
    letter-spacing: 0.5px;
  }
  .frame-badge-warm {
    background: rgba(245,158,11,0.12);
    color: #f59e0b;
    border-color: rgba(245,158,11,0.25);
  }
  .frame-badge-cyan {
    background: rgba(56,189,248,0.12);
    color: #38bdf8;
    border-color: rgba(56,189,248,0.25);
  }
  .frame-badge-green {
    background: rgba(16,185,129,0.12);
    color: #10b981;
    border-color: rgba(16,185,129,0.25);
  }

  .playback-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 14px 20px;
    border-top: 1px solid var(--border);
    background: var(--surface);
  }
  .playback-dots {
    display: flex;
    gap: 8px;
  }
  .pb-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--border);
    cursor: pointer;
    transition: all 0.3s;
  }
  .pb-dot.active {
    background: #f472b6;
    box-shadow: 0 0 8px rgba(244,114,182,0.4);
  }
  .play-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    padding: 5px 12px;
    border: 1px solid var(--border);
    background: var(--surface-alt);
    color: var(--text-dim);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .play-btn:hover { border-color: #f472b6; color: #f472b6; }
  .play-btn.playing {
    background: rgba(244,114,182,0.12);
    border-color: #f472b6;
    color: #f472b6;
  }

  /* ─── Resources Section ─── */
  .resources-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 18px 0;
  }
  .res-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 18px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface-alt);
    color: var(--text-dim);
    text-decoration: none;
    transition: all 0.3s;
    cursor: pointer;
  }
  .res-btn:hover { border-color: var(--purple); color: var(--purple); background: var(--purple-glow); }
  .res-btn.is-locked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
  .res-btn .res-icon { font-size: 1.1rem; }
  .res-soon {
    font-size: 0.6rem;
    padding: 2px 6px;
    border-radius: 3px;
    background: rgba(167,139,250,0.15);
    color: var(--purple);
    margin-left: auto;
  }

  .bibtex-block {
    position: relative;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-left: 3px solid var(--purple);
    border-radius: 8px;
    padding: 18px 22px;
    margin-top: 16px;
  }
  .bibtex-block pre {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    line-height: 1.7;
    color: var(--text-dim);
    white-space: pre-wrap;
    word-break: break-word;
    margin: 0;
  }
  .bibtex-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--purple);
    margin-bottom: 12px;
  }
  .copy-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    padding: 5px 10px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-dim);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .copy-btn:hover { border-color: var(--purple); color: var(--purple); }
 /* ─── Animations ─── */
  @keyframes pulse {
    0%, 100% { r: 6; opacity: 0.8; }
    50% { r: 10; opacity: 0.4; }
  }
  .hotspot { animation: pulse 2s ease-in-out infinite; }
  .hotspot:nth-child(2) { animation-delay: 0.3s; }
  .hotspot:nth-child(3) { animation-delay: 0.6s; }
  .hotspot:nth-child(4) { animation-delay: 0.9s; }
  .hotspot:nth-child(5) { animation-delay: 1.2s; }

  @keyframes dashmove { to { stroke-dashoffset: -20; } }
  .dash-anim { animation: dashmove 1s linear infinite; }

  @keyframes planeGlow {
    0%, 100% { stroke-opacity: 0.6; filter: drop-shadow(0 0 3px rgba(56,189,248,0.3)); }
    50% { stroke-opacity: 1; filter: drop-shadow(0 0 8px rgba(56,189,248,0.6)); }
  }
  .glow-line { animation: planeGlow 2.5s ease-in-out infinite; }

  @keyframes countUp {
    0% { opacity: 0; transform: translateY(8px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  /* ─── Footer ─── */
  .page-footer {
    text-align: center;
    padding: 50px 24px 36px;
    border-top: 1px solid var(--border);
    margin-top: 40px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-muted);
    line-height: 1.8;
  }

  /* ─── Responsive ─── */
  @media (max-width: 700px) {
    .card-body { grid-template-columns: 1fr; }
    .card-svg { border-right: none; border-bottom: 1px solid var(--border); min-height: 220px; }
    .stage-nav { gap: 3px; padding: 20px 10px 8px; }
    .stage-btn { font-size: 0.6rem; padding: 6px 10px; }
    .resources-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 1.6rem; }
  }

</style>
</head>
<body>

<div class="header">
  <h1>3D COUNTING PIPELINE</h1>
  <p>Visual walkthrough of the bus passenger counting system — from raw camera feed through heatmap correction to virtual 3D counting plane.</p>
</div>

<nav class="stage-nav">
  <button class="stage-btn" onclick="window.location.href='index.html'">← HOME</button>
  <button class="stage-btn active" onclick="scrollToStage(0)">DETECT</button>
  <button class="stage-btn" onclick="scrollToStage(1)">HEATMAP</button>
  <button class="stage-btn" onclick="scrollToStage(2)">PROJECT</button>
  <button class="stage-btn" onclick="scrollToStage(3)">PLANE</button>
  <button class="stage-btn" onclick="scrollToStage(4)">COUNT</button>
  <button class="stage-btn" onclick="scrollToStage(5)">IN ACTION</button>
  <button class="stage-btn" onclick="scrollToStage(6)">RESOURCES</button>
  
</nav>

<!-- ═══════════════ STAGE 1 ═══════════════ -->
<div class="stage" id="stage-0">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:rgba(239,68,68,0.15);color:var(--heat-hot);border-color:rgba(239,68,68,0.3);">STEP 01</span>
      <h2>The High-Angle Detection Challenge</h2>
    </div>
    <div class="card-body">
      <div class="diagram-panel">
        <svg viewBox="0 0 380 280" width="100%" height="100%">
          <!-- Bus door frame -->
          <rect x="40" y="30" width="300" height="220" rx="8" fill="none" stroke="#1e2d4a" stroke-width="1.5"/>
          <text x="55" y="22" fill="#7b8ba5" font-size="9" letter-spacing="1">CAMERA VIEW — HIGH ANGLE</text>

          <!-- Door opening -->
          <rect x="80" y="50" width="200" height="180" rx="4" fill="rgba(56,189,248,0.04)" stroke="#1e2d4a" stroke-width="1" stroke-dasharray="4 3"/>
          <text x="155" y="58" fill="#38bdf8" font-size="8" opacity="0.6">DOOR ZONE</text>
          <text x="190" y="228" text-anchor="middle" fill="#10b981" font-family="JetBrains Mono" font-size="8">DOOR OPENING</text>

          <!-- Passenger silhouettes (overlapping) -->
          <!-- Person 1 - fully visible -->
          <!-- 5 passengers (overlapping circles) -->
          <circle cx="155" cy="100" r="22" fill="rgba(56,189,248,0.2)" stroke="#38bdf8" stroke-width="1.5"/>
          <text x="155" y="104" text-anchor="middle" fill="#38bdf8" font-family="JetBrains Mono" font-size="9" font-weight="700">P1</text>
          <circle cx="200" cy="90" r="22" fill="rgba(56,189,248,0.2)" stroke="#38bdf8" stroke-width="1.5"/>
          <text x="200" y="94" text-anchor="middle" fill="#38bdf8" font-family="JetBrains Mono" font-size="9" font-weight="700">P2</text>
          <circle cx="175" cy="140" r="22" fill="rgba(56,189,248,0.2)" stroke="#38bdf8" stroke-width="1.5"/>
          <text x="175" y="144" text-anchor="middle" fill="#38bdf8" font-family="JetBrains Mono" font-size="9" font-weight="700">P3</text>
          <circle cx="215" cy="145" r="22" fill="rgba(56,189,248,0.2)" stroke="#38bdf8" stroke-width="1.5"/>
          <text x="215" y="149" text-anchor="middle" fill="#38bdf8" font-family="JetBrains Mono" font-size="9" font-weight="700">P4</text>
          <!-- P5 hidden behind P3/P4 -->
          <circle cx="190" cy="170" r="22" fill="rgba(239,68,68,0.15)" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="5,3"/>
          <text x="190" y="174" text-anchor="middle" fill="#ef4444" font-family="JetBrains Mono" font-size="9" font-weight="700">P5?</text>
          <!-- Detection boxes for P1-P4 -->
          <rect x="130" y="75" width="50" height="50" fill="none" stroke="#10b981" stroke-width="1.5"/>
          <rect x="175" y="65" width="50" height="50" fill="none" stroke="#10b981" stroke-width="1.5"/>
          <rect x="150" y="115" width="50" height="50" fill="none" stroke="#10b981" stroke-width="1.5"/>
          <rect x="190" y="120" width="50" height="50" fill="none" stroke="#10b981" stroke-width="1.5"/>

          <!-- Miss indicator -->
          <line x1="170" y1="155" x2="210" y2="185" stroke="#ef4444" stroke-width="2"/>
          <line x1="210" y1="155" x2="170" y2="185" stroke="#ef4444" stroke-width="2"/>


          <!-- Stats box -->
          <!-- <rect x="40" y="225" width="116" height="20" rx="4" fill="rgba(239,68,68,0.08)" stroke="rgba(239,68,68,0.3)" stroke-width="1"/> -->
          <text x="100" y="245" fill="#ef4444" font-size="9" text-anchor="middle" font-weight="600">DETECTED: 4 / 5</text>

          <!-- Camera icon -->
          <g transform="translate(310, 40)">
            <rect x="0" y="0" width="22" height="16" rx="3" fill="none" stroke="#7b8ba5" stroke-width="1"/>
            <circle cx="11" cy="8" r="4" fill="none" stroke="#7b8ba5" stroke-width="1"/>
            <line x1="22" y1="4" x2="28" y2="1" stroke="#7b8ba5" stroke-width="1"/>
            <line x1="22" y1="12" x2="28" y2="15" stroke="#7b8ba5" stroke-width="1"/>
          </g>
          <text x="321" y="65" fill="#7b8ba5" font-size="7" text-anchor="middle">CAM</text>
        </svg>
      </div>
      <div class="info-panel">
        <p>The dashcam captures passengers at a <strong>high oblique angle</strong> with severe occlusion at the bus door. Standard YOLO detection identifies only 4 out of 5 passengers.</p>
        <p>The 5th passenger (P5) is <strong>completely hidden</strong> behind the overlapping bodies of P3 and P4. This is the fundamental challenge: the camera sees a pile of heads, not individual people.</p>
        <div class="tag-row">
          <span class="tag">YOLO v12</span>
          <span class="tag warn">OCCLUSION</span>
          <span class="tag">4/5 DETECTED</span>
          <span class="tag">HIGH-ANGLE</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flow-connector"><div class="flow-arrow"></div></div>

<!-- ═══════════════ STAGE 2 ═══════════════ -->
<div class="stage" id="stage-1">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:rgba(245,158,11,0.15);color:var(--heat-warm);border-color:rgba(245,158,11,0.3);">STEP 02</span>
      <h2>Multi-Modal Heatmap Recovery</h2>
    </div>
    <div class="card-body">
      <div class="diagram-panel">
        <svg viewBox="0 0 380 280" width="100%" height="100%">
          <text x="55" y="22" fill="#7b8ba5" font-size="9" letter-spacing="1">DENSITY HEATMAP OVERLAY</text>
          <rect x="40" y="30" width="300" height="220" rx="8" fill="none" stroke="#1e2d4a" stroke-width="1.5"/>
          
          <!-- Door opening -->
          <rect x="80" y="50" width="200" height="180" rx="4" fill="rgba(56,189,248,0.04)" stroke="#1e2d4a" stroke-width="1" stroke-dasharray="4 3"/>
          <text x="155" y="58" fill="#38bdf8" font-size="8" opacity="0.6">DOOR ZONE</text>
          <text x="190" y="228" text-anchor="middle" fill="#10b981" font-family="JetBrains Mono" font-size="8">DOOR OPENING</text>

          <!-- Camera icon -->
          <g transform="translate(310, 40)">
            <rect x="0" y="0" width="22" height="16" rx="3" fill="none" stroke="#7b8ba5" stroke-width="1"/>
            <circle cx="11" cy="8" r="4" fill="none" stroke="#7b8ba5" stroke-width="1"/>
            <line x1="22" y1="4" x2="28" y2="1" stroke="#7b8ba5" stroke-width="1"/>
            <line x1="22" y1="12" x2="28" y2="15" stroke="#7b8ba5" stroke-width="1"/>
          </g>
          <text x="321" y="65" fill="#7b8ba5" font-size="7" text-anchor="middle">CAM</text>


          <!-- Heatmap gradient background -->
          <defs>
            <radialGradient id="h1" cx="38%" cy="40%"><stop offset="0%" stop-color="#ef4444" stop-opacity="0.6"/><stop offset="60%" stop-color="#f59e0b" stop-opacity="0.2"/><stop offset="100%" stop-color="transparent"/></radialGradient>
            <radialGradient id="h2" cx="47%" cy="45%"><stop offset="0%" stop-color="#ef4444" stop-opacity="0.6"/><stop offset="60%" stop-color="#f59e0b" stop-opacity="0.2"/><stop offset="100%" stop-color="transparent"/></radialGradient>
            <radialGradient id="h3" cx="55%" cy="38%"><stop offset="0%" stop-color="#ef4444" stop-opacity="0.55"/><stop offset="60%" stop-color="#f59e0b" stop-opacity="0.2"/><stop offset="100%" stop-color="transparent"/></radialGradient>
            <radialGradient id="h4" cx="62%" cy="48%"><stop offset="0%" stop-color="#ef4444" stop-opacity="0.5"/><stop offset="60%" stop-color="#f59e0b" stop-opacity="0.2"/><stop offset="100%" stop-color="transparent"/></radialGradient>
            <radialGradient id="h5" cx="51%" cy="50%"><stop offset="0%" stop-color="#fb923c" stop-opacity="0.55"/><stop offset="50%" stop-color="#f59e0b" stop-opacity="0.25"/><stop offset="100%" stop-color="transparent"/></radialGradient>
          </defs>

          <ellipse cx="155" cy="100" rx="45" ry="40" fill="url(#h1)"/>
          <ellipse cx="200" cy="90" rx="40" ry="38" fill="url(#h2)"/>
          <ellipse cx="175" cy="140" rx="42" ry="38" fill="url(#h3)"/>
          <ellipse cx="215" cy="145" rx="40" ry="36" fill="url(#h4)"/>
          <ellipse cx="190" cy="170" rx="35" ry="30" fill="url(#h5)"/>

          <!-- Hotspot peaks -->
            <!-- Heatmap hotspots with pulse animation -->
          <circle class="hotspot" cx="155" cy="100" r="6" fill="#f59e0b" opacity="0.8"/>
          <circle cx="165" cy="103" r="20" fill="rgba(245,158,11,0.15)" stroke="rgba(245,158,11,0.3)" stroke-width="1"/>
          
          <circle class="hotspot" cx="200" cy="90" r="6" fill="#f59e0b" opacity="0.8"/>
          <circle cx="200" cy="90" r="20" fill="rgba(245,158,11,0.15)" stroke="rgba(245,158,11,0.3)" stroke-width="1"/>
          
          <circle class="hotspot" cx="175" cy="140" r="6" fill="#f59e0b" opacity="0.8"/>
          <circle cx="175" cy="140" r="20" fill="rgba(245,158,11,0.15)" stroke="rgba(245,158,11,0.3)" stroke-width="1"/>
          
          <circle class="hotspot" cx="215" cy="145" r="6" fill="#f59e0b" opacity="0.8"/>
          <circle cx="215" cy="145" r="20" fill="rgba(245,158,11,0.15)" stroke="rgba(245,158,11,0.3)" stroke-width="1"/>
          <!-- P5 RECOVERED -->
          <circle class="hotspot" cx="190" cy="170" r="6" fill="#10b981" opacity="0.9"/>
          <circle cx="190" cy="170" r="20" fill="rgba(16,185,129,0.15)" stroke="rgba(16,185,129,0.4)" stroke-width="1.5"/>
          <text x="190" y="198" text-anchor="middle" fill="#10b981" font-family="JetBrains Mono" font-size="9" font-weight="700">P5 RECOVERED</text>
          <!-- Labels -->
          <text x="155" y="76" text-anchor="middle" fill="#f59e0b" font-family="JetBrains Mono" font-size="8">0.92</text>
          <text x="200" y="66" text-anchor="middle" fill="#f59e0b" font-family="JetBrains Mono" font-size="8">0.88</text>
          <text x="175" y="118" text-anchor="middle" fill="#f59e0b" font-family="JetBrains Mono" font-size="8">0.95</text>
          <text x="215" y="123" text-anchor="middle" fill="#f59e0b" font-family="JetBrains Mono" font-size="8">0.84</text>

          
          <!-- Color legend -->
          <rect x="250" y="245" width="80" height="8" rx="4" fill="linear-gradient(90deg, #3b82f6, #f59e0b, #ef4444)"/>
          <defs>
            <linearGradient id="legendGrad" x1="0" x2="1" y1="0" y2="0">
              <stop offset="0%" stop-color="#3b82f6"/>
              <stop offset="50%" stop-color="#f59e0b"/>
              <stop offset="100%" stop-color="#ef4444"/>
            </linearGradient>
          </defs>
          <rect x="250" y="245" width="80" height="8" rx="4" fill="url(#legendGrad)"/>
          <text x="250" y="224" fill="#7b8ba5" font-size="7">LOW</text>
          <text x="318" y="245" fill="#7b8ba5" font-size="7">HIGH</text>

          <!-- Stats box -->
          <!-- <rect x="40" y="225" width="120" height="24" rx="4" fill="rgba(16,185,129,0.08)" stroke="rgba(16,185,129,0.3)" stroke-width="1"/> -->
          <text x="100" y="245" fill="#10b981" font-size="9" text-anchor="middle" font-weight="600">HOTSPOTS: 5 / 5</text>
        </svg>
      </div>
      <div class="info-panel">
        <p>While the detector misses one person, the <strong>Density Heatmap</strong> identifies all five distinct density peaks — including the occluded P5.</p>
        <p>Each hotspot represents a local maximum in the crowd density map. The heatmap ensures the Virtual Bus receives <strong>5 inputs instead of 4</strong>, correcting the detector's blind spot.</p>
        <div class="tag-row">
          <span class="tag">DENSITY MAP</span>
          <span class="tag warn">OCCLUSION FIX</span>
          <span class="tag">5 PEAKS</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flow-connector"><div class="flow-arrow"></div></div>

<!-- ═══════════════ STAGE 3 ═══════════════ -->
<div class="stage" id="stage-2">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:rgba(56,189,248,0.15);color:var(--accent);border-color:rgba(56,189,248,0.3);">STEP 03</span>
      <h2>Homography — Side-View to Top-Down</h2>
    </div>
    <div class="card-body">
      <div class="diagram-panel">
        <svg viewBox="0 0 380 280" width="100%" height="100%">
          <!-- Left: Camera view (trapezoid) -->
          <text x="30" y="18" fill="#7b8ba5" font-size="8" letter-spacing="1">CAMERA VIEW</text>
          <polygon points="50,40 160,50 165,200 45,190" fill="rgba(56,189,248,0.04)" stroke="#1e2d4a" stroke-width="1.5"/>

          <!-- 5 dots in camera view -->
          <circle cx="80" cy="100" r="5" fill="#38bdf8"/>
          <circle cx="100" cy="110" r="5" fill="#38bdf8"/>
          <circle cx="115" cy="95" r="5" fill="#38bdf8"/>
          <circle cx="130" cy="115" r="5" fill="#38bdf8"/>
          <circle cx="108" cy="130" r="5" fill="#10b981"/>

          <!-- Arrow / transform -->
          <line x1="172" y1="125" x2="222" y2="125" stroke="#38bdf8" stroke-width="1.5" stroke-dasharray="4 3" class="dash-anim"/>
          <polygon points="222,120 232,125 222,130" fill="#38bdf8"/>
          <text x="202" y="117" text-anchor="middle" fill="#38bdf8" font-family="JetBrains Mono" font-size="7">H·[u,v,1]ᵀ</text>
          <text x="202" y="140" fill="#7b8ba5" font-family="JetBrains Mono" font-size="6" text-anchor="middle">HOMOGRAPHY</text>


          <!-- Right: Top-down virtual bus -->
          <text x="240" y="18" fill="#7b8ba5" font-size="8" letter-spacing="1">TOP-DOWN</text>

          <!-- Bus outline -->
          <rect x="235" y="30" width="130" height="220" rx="10" fill="rgba(167,139,250,0.04)" stroke="#a78bfa" stroke-width="1.5"/>

          <!-- Door opening -->
          <rect x="235" y="78" width="6" height="50" rx="2" fill="#a78bfa" opacity="0.5"/>
          <text x="228" y="98" fill="#a78bfa" font-size="6" text-anchor="end">DOOR</text>
          <text x="228" y="108" fill="#7b8ba5" font-size="6" text-anchor="end">1.2m</text>

          <!-- Width annotation --> 
          <rect x="236" y="60" width="84" height="76" rx="4" fill="rgba(251,146,60,0.06)" stroke="#fb923c" stroke-width="1" stroke-dasharray="4,3"/>
          <text x="286" y="58" fill="#fb923c" font-family="JetBrains Mono" font-size="5.5" text-anchor="end">DOOR ZONE</text>


          <!-- ═══ PEOPLE: inside door zone (3 approaching) ═══ -->
          <circle cx="270" cy="110" r="5" fill="#38bdf8"/>
          <circle cx="290" cy="102" r="5" fill="#38bdf8"/>
          <circle cx="258" cy="100" r="5" fill="#38bdf8"/>

          <!-- Width annotation -->
          <line x1="240" y1="258" x2="360" y2="258" stroke="#7b8ba5" stroke-width="0.5"/>
          <line x1="240" y1="255" x2="240" y2="261" stroke="#7b8ba5" stroke-width="0.5"/>
          <line x1="360" y1="255" x2="360" y2="261" stroke="#7b8ba5" stroke-width="0.5"/>
          <text x="300" y="270" fill="#7b8ba5" font-family="JetBrains Mono" font-size="7" text-anchor="middle">2.55m</text>

          <!-- ═══ COUNTING LINE — horizontal, close to first seat row ═══ -->
          <line x1="236" y1="138" x2="320" y2="138" stroke="#38bdf8" stroke-width="2" class="glow-line"/>
          <text x="300" y="134" fill="#38bdf8" font-family="JetBrains Mono" font-size="6" text-anchor="middle" opacity="0.7">COUNTING PLANE</text>

          <!-- ═══ PEOPLE: crossing the counting line (in aisle) ═══ -->
          <circle cx="280" cy="128" r="4" fill="#f59e0b"/>
          <circle cx="290" cy="138" r="4" fill="#f59e0b"/>
          <circle cx="300" cy="146" r="4" fill="#f59e0b"/>

          <!-- ═══ SEAT ROWS (below counting line = inside bus) ═══ -->
          <g opacity="0.3">
            <!-- Right-side seats -->
            <rect x="320" y="137" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="320" y="155" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="320" y="173" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="320" y="191" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="320" y="209" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <!-- Left-side seats -->
            <rect x="242" y="137" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="242" y="155" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="242" y="173" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="242" y="191" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
            <rect x="242" y="209" width="40" height="11" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
          </g>

          <!-- ═══ PEOPLE: seated in rows (inside bus, past line) ═══ -->
          <circle cx="252" cy="143" r="4" fill="#10b981" opacity="0.7"/>
          <circle cx="252" cy="179" r="4" fill="#10b981" opacity="0.7"/>
          <circle cx="330" cy="161" r="4" fill="#10b981" opacity="0.7"/>
          <circle cx="252" cy="215" r="4" fill="#10b981" opacity="0.7"/>
          <circle cx="330" cy="197" r="4" fill="#10b981" opacity="0.7"/>

          <!-- ═══ FLOW ARROW (in aisle, door → seats) ═══ -->
          <line x1="290" y1="72" x2="290" y2="222" stroke="#3e4d68" stroke-width="1" stroke-dasharray="4,3"/>
          <polygon points="287,218 290,228 293,218" fill="#3e4d68"/>
          <text x="300" y="236" fill="#3e4d68" font-family="JetBrains Mono" font-size="6">FLOW ↓</text>

          <!-- ═══ BACK SEAT (at rear of bus, after flow label) ═══ -->
          <g opacity="0.3">
            <rect x="242" y="238" width="118" height="9" rx="2" fill="none" stroke="#7b8ba5" stroke-width="0.8"/>
          </g>
          <circle cx="270" cy="242" r="3.5" fill="#10b981" opacity="0.5"/>
          <circle cx="300" cy="242" r="3.5" fill="#10b981" opacity="0.5"/>
          <circle cx="330" cy="242" r="3.5" fill="#10b981" opacity="0.5"/>
        </svg>
      </div>
      <div class="info-panel">
        <p>The <strong>Homography Matrix H</strong> transforms the angled camera view into a metric top-down floor plan. Using the known bus width (2.55m) and door width (1.2m), we map all 5 detections into the virtual space.</p>
        <p>In this unwarped view, the counting plane becomes a clean vertical line.</p>
        <div class="tag-row">
          <span class="tag warn">HOMOGRAPHY</span>
          <span class="tag">TOP-DOWN MAPPING</span>
          <span class="tag">METRIC SPACE</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flow-connector"><div class="flow-arrow"></div></div>

<!-- ═══════════════ STAGE 4 ═══════════════ -->
<div class="stage" id="stage-3">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:var(--purple-glow);color:var(--purple);border-color:rgba(167,139,250,0.3);">STEP 04</span>
      <h2>Interior 3D Counting Plane</h2>
    </div>
    <div class="card-body">
      <div class="diagram-panel">
        <svg viewBox="0 0 380 280" width="100%" height="100%">
          <text x="30" y="18" fill="#7b8ba5" font-size="8" letter-spacing="1">VIRTUAL BUS — SIDE CUTAWAY</text>

          <!-- Bus cross-section -->
          <rect x="30" y="40" width="320" height="180" rx="12" fill="rgba(167,139,250,0.03)" stroke="#1e2d4a" stroke-width="1.5"/>

          <!-- Floor -->
          <line x1="30" y1="200" x2="350" y2="200" stroke="#1e2d4a" stroke-width="2"/>
          <text x="45" y="215" fill="#7b8ba5" font-size="7">FLOOR</text>

          <!-- Ceiling -->
          <line x1="30" y1="55" x2="350" y2="55" stroke="#1e2d4a" stroke-width="1"/>
          <text x="45" y="50" fill="#7b8ba5" font-size="7">CEILING</text>

          <!-- Door opening (left) -->
          <rect x="30" y="80" width="8" height="120" rx="2" fill="rgba(245,158,11,0.3)" stroke="#f59e0b" stroke-width="1.5"/>
          <text x="16" y="145" fill="#f59e0b" font-size="7" text-anchor="end" transform="rotate(-90,16,145)">DOOR</text>

          <!-- Floor line at door (what we IGNORE) -->
          <line x1="45" y1="55" x2="45" y2="200" stroke="#ef4444" stroke-width="1" stroke-dasharray="4 3" opacity="0.5"/>
          <text x="50" y="225" fill="#ef4444" font-size="7">FLOOR LINE</text>
          <text x="50" y="234" fill="#ef4444" font-size="6" opacity="0.7">✗ IGNORED</text>

          <!-- Interior pole with stop knob -->
          <line x1="160" y1="55" x2="160" y2="200" stroke="#a78bfa" stroke-width="3" opacity="0.6"/>
          <circle cx="160" cy="110" r="6" fill="#a78bfa" stroke="#e2e8f0" stroke-width="1.5"/>
          <text x="168" y="112" fill="#a78bfa" font-size="7">STOP KNOB</text>
          <text x="160" y="225" fill="#a78bfa" font-size="7" text-anchor="middle">INTERIOR POLE</text>

          <!-- THE COUNTING PLANE — the "blue curtain" -->
          <line class="glow-line" x1="160" y1="55" x2="160" y2="200" stroke="#38bdf8" stroke-width="2"/>
          <rect x="155" y="55" width="10" height="145" rx="0" fill="rgba(56,189,248,0.08)"/>

          <text x="175" y="75" fill="#38bdf8" font-size="8" font-weight="600">COUNTING</text>
          <text x="175" y="86" fill="#38bdf8" font-size="8" font-weight="600">PLANE</text>
          <text x="175" y="97" fill="#38bdf8" font-size="6" opacity="0.7">"BLUE CURTAIN"</text>

          <!-- "Point of No Return" label -->
          <line x1="160" y1="170" x2="220" y2="170" stroke="rgba(56,189,248,0.3)" stroke-width="0.8" stroke-dasharray="3 2"/>
          <rect x="222" y="162" width="110" height="18" rx="4" fill="rgba(56,189,248,0.08)" stroke="rgba(56,189,248,0.3)" stroke-width="1"/>
          <text x="277" y="175" fill="#38bdf8" font-size="7" text-anchor="middle" font-weight="600">POINT OF NO RETURN</text>

          <!-- Passengers approaching -->
          <!-- Before plane -->
          <circle cx="90" cy="170" r="8" fill="rgba(245,158,11,0.3)" stroke="#f59e0b" stroke-width="1.5"/>
          <text x="90" y="160" fill="#f59e0b" font-size="7" text-anchor="middle">→</text>

          <circle cx="120" cy="165" r="8" fill="rgba(245,158,11,0.3)" stroke="#f59e0b" stroke-width="1.5"/>
          <text x="120" y="155" fill="#f59e0b" font-size="7" text-anchor="middle">→</text>

          <!-- After plane (counted) -->
          <circle cx="210" cy="172" r="8" fill="rgba(16,185,129,0.3)" stroke="#10b981" stroke-width="1.5"/>
          <text x="210" y="162" fill="#10b981" font-size="7" text-anchor="middle">✓</text>

          <circle cx="260" cy="168" r="8" fill="rgba(16,185,129,0.3)" stroke="#10b981" stroke-width="1.5"/>
          <text x="260" y="158" fill="#10b981" font-size="7" text-anchor="middle">✓</text>

          <!-- Seat rows (right side) -->
          <g opacity="0.2">
            <rect x="280" y="160" width="50" height="30" rx="3" fill="none" stroke="#7b8ba5" stroke-width="1"/>
            <rect x="280" y="105" width="50" height="30" rx="3" fill="none" stroke="#7b8ba5" stroke-width="1"/>
          </g>
        </svg>
      </div>
      <div class="info-panel">
        <p>The <strong>Counting Plane</strong> (the "blue curtain") is a vertical surface spanning floor-to-ceiling, anchored to the interior handrail pole and its stop knob. It sits <strong>deep inside the cabin</strong> — well past the door threshold.</p>
        <p>A naive approach would place a counting line at the door (shown in red, ✗ IGNORED). But from a high-angle camera, a person's head can appear to cross the door line while their body is still outside. By placing the plane at the <strong>interior pole</strong>, we ensure a passenger is fully aboard before being counted.</p>
        <div class="tag-row">
          <span class="tag">INTERIOR POLE</span>
          <span class="tag warn">VERTICAL PLANE</span>
          <span class="tag">FLUX GATE</span>
          <span class="tag">ANTI-PARALLAX</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flow-connector"><div class="flow-arrow"></div></div>

<!-- ═══════════════ STAGE 5 ═══════════════ -->
<div class="stage" id="stage-4">
  <div class="card">
    <div class="card-header">
      <span class="step-badge">STEP 05</span>
      <h2>BoTSORT Vector Crossing — Final Count</h2>
    </div>
    <div class="card-body">
      <div class="diagram-panel">
        <svg viewBox="0 0 380 280" width="100%" height="100%">
          <text x="30" y="18" fill="#7b8ba5" font-size="8" letter-spacing="1">VIRTUAL BUS — TOP DOWN + TRAJECTORIES</text>

          <!-- Bus outline -->
          <rect x="60" y="30" width="260" height="210" rx="10" fill="rgba(167,139,250,0.03)" stroke="#1e2d4a" stroke-width="1.5"/>

          <!-- Door -->
          <rect x="60" y="70" width="6" height="50" rx="2" fill="#f59e0b" opacity="0.5"/>
          <text x="52" y="98" fill="#f59e0b" font-size="7" text-anchor="end">DOOR</text>

          <!-- Counting plane line (vertical in top-down) -->
          <line class="glow-line" x1="160" y1="35" x2="160" y2="235" stroke="#38bdf8" stroke-width="2.5"/>
          <text x="163" y="45" fill="#38bdf8" font-size="7" font-weight="600">PLANE</text>

          <!-- Trajectory 1 - crossed -->
          <polyline points="80,75 100,78 125,80 145,82 170,85 200,88" fill="none" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4 2"/>
          <circle cx="200" cy="88" r="5" fill="#10b981"/>
          <text x="208" y="86" fill="#10b981" font-size="7">P1 ✓</text>

          <!-- Trajectory 2 - crossed -->
          <polyline points="82,90 105,93 130,97 150,100 175,103 210,107" fill="none" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4 2"/>
          <circle cx="210" cy="107" r="5" fill="#10b981"/>
          <text x="218" y="105" fill="#10b981" font-size="7">P2 ✓</text>

          <!-- Trajectory 3 - crossed -->
          <polyline points="78,105 98,108 120,112 142,115 168,118 195,122" fill="none" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4 2"/>
          <circle cx="195" cy="122" r="5" fill="#10b981"/>
          <text x="203" y="120" fill="#10b981" font-size="7">P3 ✓</text>

          <!-- Trajectory 4 - crossed -->
          <polyline points="85,118 108,122 132,126 155,130 180,133 220,138" fill="none" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4 2"/>
          <circle cx="220" cy="138" r="5" fill="#10b981"/>
          <text x="228" y="136" fill="#10b981" font-size="7">P4 ✓</text>

          <!-- Trajectory 5 - crossed (the recovered one) -->
          <polyline points="84,100 106,104 128,108 148,112 172,116 205,120" fill="none" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4 2"/>
          <circle cx="205" cy="120" r="6" fill="#10b981" stroke="#e2e8f0" stroke-width="1"/>
          <text x="213" y="130" fill="#10b981" font-size="7" font-weight="700">P5 ✓</text>

          <!-- Cross markers on the plane -->
          <g>
            <line x1="156" y1="82" x2="164" y2="82" stroke="#38bdf8" stroke-width="2"/>
            <line x1="156" y1="100" x2="164" y2="100" stroke="#38bdf8" stroke-width="2"/>
            <line x1="156" y1="112" x2="164" y2="112" stroke="#38bdf8" stroke-width="2"/>
            <line x1="156" y1="115" x2="164" y2="115" stroke="#38bdf8" stroke-width="2"/>
            <line x1="156" y1="130" x2="164" y2="130" stroke="#38bdf8" stroke-width="2"/>
          </g>

          <!-- Result box -->
          <rect x="180" y="175" width="120" height="50" rx="8" fill="rgba(16,185,129,0.08)" stroke="#10b981" stroke-width="1.5"/>
          <text x="240" y="196" fill="#10b981" font-size="11" text-anchor="middle" font-weight="700">IN: +5</text>
          <text x="240" y="212" fill="#7b8ba5" font-size="7" text-anchor="middle">ALL VECTORS CROSSED</text>

          <!-- Direction arrow -->
          <line x1="75" y1="180" x2="140" y2="180" stroke="#7b8ba5" stroke-width="1" stroke-dasharray="3 2"/>
          <polygon points="140,177 148,180 140,183" fill="#7b8ba5"/>
          <text x="108" y="195" fill="#7b8ba5" font-size="7" text-anchor="middle">BOARDING →</text>
        </svg>
      </div>
      <div class="info-panel">
        <p><strong>BoTSORT</strong> tracks each passenger as a "dot" moving through the virtual bus floor plan. The counter increments only when a dot's trajectory <strong>crosses the interior counting plane</strong> — shown here as tick marks on the vertical blue line.</p>
        <p>All 5 passengers — including P5, recovered by the heatmap in Step 02 — produce clear crossing events. Final count: <strong>IN: +5</strong>. Because the plane sits at the interior pole (not the door), a head appearing "inside" from the camera angle won't trigger a false count.</p>
        <div class="tag-row">
          <span class="tag">BoTSORT</span>
          <span class="tag">VECTOR CROSSING</span>
          <span class="tag">5/5 CORRECT</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flow-connector"><div class="flow-arrow"></div></div>

<!-- ═══════════════ STAGE 6 ═══════════════ -->
<div class="stage" id="stage-5">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:rgba(244,114,182,0.15);color:#f472b6;border-color:rgba(244,114,182,0.3);">STEP 06</span>
      <h2>In Action — Implementation on Live Footage</h2>
    </div>
    <div class="card-body card-body-gallery">

      <!-- Sub-navigation for the 4 frames -->
      <div class="gallery-nav">
        <button class="gal-btn active" onclick="showFrame(0)">
          <span class="gal-num">A</span> Raw Feed
        </button>
        <button class="gal-btn" onclick="showFrame(1)">
          <span class="gal-num">B</span> Heatmap
        </button>
        <button class="gal-btn" onclick="showFrame(2)">
          <span class="gal-num">C</span> Flux Plane
        </button>
        <button class="gal-btn" onclick="showFrame(3)">
          <span class="gal-num">D</span> 3D Count
        </button>
      </div>

      <!-- Frame container -->
      <div class="frame-container">
        <div class="frame active" id="frame-0">
          <img src="files/images/step1.png">
          <div class="frame-caption">
            <span class="frame-badge">A — RAW FEED</span>
            <p>The physical landmark: interior handrail with <strong>STOP knob</strong>. This pole serves as the fixed anchor point for the counting plane. Camera captures passengers at a high oblique angle with significant occlusion at the door.</p>
          </div>
        </div>
        <div class="frame" id="frame-1">
          <img src="files/images/step3.png">
          <div class="frame-caption">
            <span class="frame-badge frame-badge-warm">B — HEATMAP + DETECTION</span>
            <p>Multi-modal correction in action. <strong>Green boxes</strong> show YOLO detections. <strong>Orange/red heatmap</strong> reveals density peaks — recovering occluded passengers that bounding boxes miss. The heatmap ensures the Virtual Bus receives the correct input count.</p>
          </div>
        </div>
        <div class="frame" id="frame-2">
            <img src="files/images/step2.png">
            <div class="frame-caption">
              <span class="frame-badge frame-badge-cyan">C — FLUX PLANE</span>
              <p>The <strong>3D Counting Plane</strong> visualized on the actual footage — a transparent cyan surface anchored to the interior pole at the STOP knob. This "virtual curtain" is the <strong>Point of No Return</strong>. The yellow ✕ marks a crossing event being registered.</p>
          </div>
        </div>
        <div class="frame" id="frame-3">
          <img src="files/images/3d.png">
          <div class="frame-caption">
            <span class="frame-badge frame-badge-green">D — 3D DIGITAL TWIN</span>
            <p>The full Digital Twin: an isometric view of the virtual bus interior. The blue plane spans floor-to-ceiling at the pole. <strong>Red spheres</strong> are tracked passenger centroids with directional arrows showing their trajectories crossing the plane. <strong>Count: 5</strong> — all passengers confirmed.</p>
          </div>
        </div>
      </div>

      <!-- Auto-play indicator -->
      <div class="playback-bar">
        <div class="playback-dots">
          <span class="pb-dot active" onclick="showFrame(0)"></span>
          <span class="pb-dot" onclick="showFrame(1)"></span>
          <span class="pb-dot" onclick="showFrame(2)"></span>
          <span class="pb-dot" onclick="showFrame(3)"></span>
        </div>
        <button class="play-btn" onclick="toggleAutoplay()" id="playBtn">▶ Auto-play</button>
      </div>

    </div>
  </div>
</div>

<!-- ═══════════════ SUMMARY TABLE ═══════════════ -->
<div class="summary">
  <table class="summary-table">
    <thead>
      <tr>
        <th>Flow Step</th>
        <th>Input Source</th>
        <th>Logic</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="color:var(--text);">01 — Observation</td>
        <td>Camera Side-View</td>
        <td>Raw pixel data → YOLO detection (4/5)</td>
      </tr>
      <tr>
        <td style="color:var(--text);">02 — Recovery</td>
        <td>Density Heatmap</td>
        <td>Finds hidden 5th person via density peaks</td>
      </tr>
      <tr>
        <td style="color:var(--text);">03 — Projection</td>
        <td>Homography Matrix</td>
        <td>Maps 5 dots into the Virtual Bus (top-down)</td>
      </tr>
      <tr>
        <td style="color:var(--text);">04 — Threshold</td>
        <td>Interior Pole Plane</td>
        <td>"Flux Gate" deep in cabin — Point of No Return</td>
      </tr>
      <tr>
        <td style="color:var(--text);">05 — Result</td>
        <td>BoTSORT Vectors</td>
        <td>IN: +5 — all crossings confirmed</td>
      </tr>
    </tbody>
  </table>
</div>
<div class="flow-connector"><div class="flow-arrow"></div></div>
  
<!-- ═══════════════ STAGE 7: RESOURCES ═══════════════ -->
<div class="stage" id="stage-6">
  <div class="card">
    <div class="card-header">
      <span class="step-badge" style="background:var(--purple-glow);color:var(--purple);border-color:rgba(167,139,250,0.3);">STEP 07</span>
      <h2>Resources & Citation</h2>
    </div>
    <div class="card-body" style="display:block; padding: 26px;">
      <p style="font-size:0.95rem; color:var(--text-dim); line-height:1.8; margin-bottom:18px;">
        Access project materials and cite this work. Code and data are proprietary to partner organizations.
      </p>

      <div class="resources-grid">
        <a href="YOUR_PAPER_LINK" class="res-btn" target="_blank" rel="noopener">
          <span class="res-icon">📄</span> Paper <span class="res-soon">Coming soon</span>
        </a>
        <a href="YOUR_SLIDES_LINK" class="res-btn" target="_blank" rel="noopener">
          <span class="res-icon">🖥️</span> Slides <span class="res-soon">Coming soon</span>
        </a>
        <span class="res-btn is-locked" title="Proprietary to Basigo">
          <span class="res-icon">🔒</span> Code <span class="res-soon">Proprietary</span>
        </span>
        <span class="res-btn is-locked" title="Proprietary to Basigo">
          <span class="res-icon">🔒</span> Data <span class="res-soon">Proprietary</span>
        </span>
      </div>

      <div class="bibtex-label">BIBTEX CITATION</div>
      <div class="bibtex-block">
        <button class="copy-btn" onclick="copyBibtex()">⧉ Copy</button>
        <pre><code id="bibtex-code">@article{kyatha20253dcounting,
  title     = {3D Counting Pipeline: Vision-Based Passenger
               Counting via Digital Twin Projection},
  author    = {Kyatha, Mercy},
  year      = {2025},
  note      = {Multi-modal detection with homography-based
               3D counting plane for transit buses.
               Nairobi and Kigali deployments.}
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════ FOOTER ═══════════════ -->
<div class="page-footer">
  3D Counting Pipeline — Bus Passenger Counting System<br>
  Nairobi · Kigali · 2024–2026
</div>

<script>
  const stages = document.querySelectorAll('.stage');
  const navBtns = document.querySelectorAll('.stage-btn:not(.home-btn)');

  function scrollToStage(i) {
    stages[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  // Highlight active nav button on scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        const idx = Array.from(stages).indexOf(e.target);
        navBtns.forEach(b => b.classList.remove('active'));
        if (navBtns[idx]) navBtns[idx].classList.add('active');
      }
    });
  }, { threshold: 0.4 });

  stages.forEach(s => observer.observe(s));

  // ─── Gallery Logic ───
  let currentFrame = 0;
  let autoplayInterval = null;
  const totalFrames = 5;

  function showFrame(idx) {
    currentFrame = idx;
    document.querySelectorAll('.frame').forEach((f, i) => {
      f.classList.toggle('active', i === idx);
    });
    document.querySelectorAll('.gal-btn').forEach((b, i) => {
      b.classList.toggle('active', i === idx);
    });
    document.querySelectorAll('.pb-dot').forEach((d, i) => {
      d.classList.toggle('active', i === idx);
    });
  }

  function toggleAutoplay() {
    const btn = document.getElementById('playBtn');
    if (autoplayInterval) {
      clearInterval(autoplayInterval);
      autoplayInterval = null;
      btn.textContent = '▶ Auto-play';
      btn.classList.remove('playing');
    } else {
      autoplayInterval = setInterval(() => {
        showFrame((currentFrame + 1) % totalFrames);
      }, 3000);
      btn.textContent = '⏸ Pause';
      btn.classList.add('playing');
    }
  }

  // ─── Copy BibTeX ───
  function copyBibtex() {
    const text = document.getElementById('bibtex-code').innerText;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = '✓ Copied';
      btn.style.color = 'var(--green)';
      btn.style.borderColor = 'var(--green)';
      setTimeout(() => {
        btn.textContent = '⧉ Copy';
        btn.style.color = '';
        btn.style.borderColor = '';
      }, 2000);
    });
  }

</script>

</body>
</html>
